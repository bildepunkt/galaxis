{"version":3,"sources":["webpack:///webpack/bootstrap 56febe854f378d9a4d53","webpack:///./play/main.js","webpack:///./src/Game.js","webpack:///./src/Camera.js","webpack:///./src/Pool.js","webpack:///./src/util.js","webpack:///./src/Viewport.js","webpack:///./src/Input.js","webpack:///./src/Listeners.js","webpack:///./src/FSM.js","webpack:///./src/Ticker.js","webpack:///./src/Preloader.js","webpack:///./src/debug.js","webpack:///./src/Sprite.js","webpack:///./src/shape/Rectangle.js"],"names":["initial","preload","init","bgColor","game","camera","x","rect","pivotX","pivotY","scaleX","scaleY","alpha","rotation","draggable","rect2","rect3","pool","add","listeners","e","console","log","target","update","delta","maxX","width","fsm","load","destroy","removeAll","play","reset","debug","Game","states","options","defaults","height","id","listenForMouse","listenForTouch","listenForKeyboard","Object","assign","boot","viewport","input","canvas","ticker","bind","state","context","executeHandlers","clear","save","translate","y","each","item","render","restore","Camera","Pool","items","push","index","getCount","splice","fn","scope","i","len","doContinue","filteredItems","predicate","length","fromIndex","indexOf","getIndex","movee","indices","remove","addAt","isAtFront","isAtBack","removee","removed","itemMatch","a","b","uid","getBoundingBox","w","Math","abs","h","x1","globalX","y1","globalY","x2","y2","minX","minY","maxY","pointRectCollide","bb","getScaleFactor","factor","style","cssWidth","parseInt","Xform","stack","getSet","xforms","getTransforms","rad","set","clone","pop","Viewport","document","querySelector","getContext","xform","original","rotate","scale","call","deg","fill","fillStyle","fillRect","clearRect","ClickManager","start","end","startEvent","endEvent","clickee","event","clickEvents","type","DragManager","move","moveEvent","dragee","isDragging","canDrag","dragEvents","Input","queuedEvents","handleEvents","addEventListener","mouseClickManager","mouseDragManager","touchClickManager","touchDragManager","preventDefault","stopPropagation","boundingRect","getBoundingClientRect","scaleFactor","domEvent","ctrlKey","shiftKey","metaKey","button","touches","pageX","pageY","changedTouches","floor","left","window","scrollX","top","scrollY","deltaX","deltaY","concat","getEvents","Listeners","dragActionManager","offset","handle","handler","events","handlerObj","FSM","name","Ticker","callback","then","Date","now","cancelled","requestId","requestAnimationFrame","min","cancelAnimationFrame","Preloader","paths","loaded","count","warn","path","asset","getType","Audio","Image","onload","onLoad","drawGrid","size","color","widthWithCam","heightWithCam","halfWidth","halfHeight","linesX","linesY","strokeStyle","globalAlpha","lineWidth","beginPath","moveTo","lineTo","stroke","drawPivot","halfSize","PI","drawBoundingBox","Sprite","visible","composite","globalCompositeOperation","compositeOperation","Rectangle"],"mappings":"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","file":"bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 56febe854f378d9a4d53","import Game from \"../src/Game\";\nimport Rectangle from \"../src/shape/Rectangle\";\nimport { getBoundingBox } from \"../src/util\";\n\nnew Game({\n    initial: {\n        preload: [\n            \"assets/cragger.png\"\n        ],\n\n        init () {\n            this.bgColor = \"#789\";\n\n            this.game.camera.x = 64;\n\n            this.rect = new Rectangle(64, 64);\n            this.rect.pivotX = 32;\n            this.rect.pivotY = 32;\n            this.rect.scaleX = -2;\n            this.rect.scaleY = -2;\n            this.rect.alpha = 0.2;\n            this.rect.rotation = 7.5;\n            this.rect.draggable = true;\n\n            this.rect2 = new Rectangle(320, 256);\n            this.rect2.draggable = true;    \n            this.rect2.pivotX = -16;\n            this.rect2.pivotY = -16;\n            this.rect2.scaleX = -1;\n            this.rect2.scaleY = -1;\n            this.rect2.alpha = 0.4;\n            this.rect2.rotation = -45;\n\n            this.rect3 = new Rectangle(512, 64);\n            this.rect3.alpha = 0.4;\n            this.rect3.draggable = true;\n\n            this.game.pool.add(this.rect, this.rect2, this.rect3);\n\n            this.game.listeners.add(\"click\", (e)=> {\n                console.log(getBoundingBox(e.target));\n            }, this.rect);\n\n            this.game.listeners.add(\"drag\", (e)=> {\n                console.log(getBoundingBox(e.target));\n            }, this.rect2);\n\n            this.game.listeners.add(\"mousemove\", (e)=> {\n                console.log(getBoundingBox(e.target));\n            }, this.rect3);\n        },\n\n        update (delta) {\n            //console.log(\"initial#update\", delta);\n\n            //let speed = delta / 4;\n\n            //this.rect.x += speed;\n            //this.rect.rotation += speed;\n\n            if (getBoundingBox(this.rect).maxX >= this.game.width) {\n                this.game.fsm.load(\"play\");\n            }\n        },\n\n        destroy () {\n            console.log(\"initial#remove\");\n\n            this.game.pool.removeAll();\n        }\n    },\n    play: {\n        init () {\n            console.log(\"play#init\");\n            console.log(this.game.listeners);\n\n            this.game.listeners.add(\"click\", ()=> {\n                this.game.reset();    \n            });\n        },\n        update (delta) {\n            console.log(\"play#update\", delta);\n        }\n    }\n}, {\n    debug: true\n});\n\n\n\n// WEBPACK FOOTER //\n// ./play/main.js","import Camera from \"./Camera\";\nimport Pool from \"./Pool\";\nimport Viewport from \"./Viewport\";\nimport Input from \"./Input\";\nimport Listeners from \"./Listeners\";\nimport FSM from \"./FSM\";\nimport Ticker from \"./Ticker\";\nimport { drawGrid, drawPivot, drawBoundingBox } from \"./debug\";\n\nexport default class Game {\n    constructor (states, options={}) {\n        const defaults = {\n            width: 640,\n            height: 512,\n            id: \"game\",\n            debug: false,\n            listenForMouse: true,\n            listenForTouch: true,\n            listenForKeyboard: true\n        };\n\n        this.states = states;\n        this.options = Object.assign(defaults, options);\n\n        this.boot();\n    }\n\n    boot () {\n        // TODO add plugin support with events & lifecycle directives\n        this.camera = new Camera();\n        this.pool = new Pool();\n        this.viewport = new Viewport(this.options);\n        this.input = new Input(this.viewport.canvas, this.pool, this.camera, this.options);\n        this.listeners = new Listeners(this.input);\n        this.fsm = new FSM(this);\n        this.ticker = new Ticker(this.update.bind(this));\n\n        this.fsm.load(\"initial\");\n    }\n\n    reset () {\n        this.pool.removeAll();\n        this.listeners.reset();\n\n        this.fsm.load(\"initial\");\n    }\n\n    update (delta) {\n        if (!this.fsm.state) {\n            return;\n        }\n\n        let context = this.viewport.context;\n\n        this.listeners.executeHandlers();\n        this.viewport.clear(this.fsm.state.bgColor);\n\n        context.save();\n        context.translate(-this.camera.x, -this.camera.y);\n\n        if (this.options.debug) {\n            // TODO account for camera\n            drawGrid(context, this.camera, this.options.width, this.options.height);\n        }\n\n        let state = this.fsm.state;\n        state.update(delta);\n        state.game.pool.each(item => {\n            context.save();\n            item.render(context);\n            context.restore();\n\n            if (this.options.debug) {\n                drawBoundingBox(context, item);\n                drawPivot(context, item);\n            }\n        }, this);\n\n        context.restore();\n    }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/Game.js","export default class Camera {\n    constructor (x=0, y=0) {\n        this.x = x;\n        this.y = y;\n    }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/Camera.js","import { itemMatch } from \"./util\";\n\nexport default class Pool {\n    constructor (...items) {\n        this.items = items || [];\n    }\n    \n    /**\n     * Add n items(s)\n     * @method Collection#add\n     * @param  {...Object} items - item(s) to add\n     */\n    add (...items) {\n        for (let item of items) {\n            this.items.push(item);\n        }\n    }\n\n    /**\n     * Add an item at a given index\n     * @method Collection#addAt\n     * @param  {Integer} index - The index to add the item\n     * @param  {Any}     item - The item to add\n     */\n    addAt (index, item) {\n        if (index > this.getCount()) {\n            this.add(item);\n        } else {\n            this.items.splice(index, 0, item);\n        }\n    }\n\n    /**\n     * Iterates the collection's sorted items. The item, index, and name are supplied\n     * to the provided function\n     * @method Collection#each\n     * @param {Function} fn - The function to execute on the iterable\n     * @param {Object} [scope] - The scope with which to execute the function\n     */\n    each (fn, scope) {\n        fn = scope ? fn.bind(scope) : fn;\n\n        for (let i = 0, len = this.getCount(); i < len; i++) {\n            let item = this.items[i];\n            let doContinue;\n\n            // if item on last item and an item is removed\n            if (!item) {\n                break;\n            }\n\n            doContinue = fn(item, i);\n\n            if (doContinue === false) {\n                break;\n            }\n        }\n    }\n\n    /**\n     * Returns an object at a given index\n     * @method Collection#fetchAt\n     * @param  {Integer} index - The index\n     * @return {Any}\n     */\n    fetchAt (index) {\n        return this.items[index];\n    }\n\n    /**\n     * iterates items and return the ones that meet criteria\n     * @method Collection#filter\n     * @param  {Function} fn - Truth predicate\n     * @param  {Object} [scope] - The scope in which to execute the function\n     * @return {Array}\n     */\n    filter(fn, scope) {\n        let filteredItems = [];\n\n        this.each((item, i)=> {\n            let predicate = fn(item, i);\n\n            if (predicate) {\n                filteredItems.push(item);\n            }\n        }, scope);\n\n        return filteredItems;\n    }\n\n    /**\n     * Returns the count of items in group\n     * @method Collection#getCount\n     * @return {Integer} - The item count\n     */\n    getCount () {\n        return this.items.length;\n    }\n\n    /**\n     * Returns the given item's index, with optional starting index\n     * @method Collection#getIndex\n     * @param  {Any} item - the item to query\n     * @param  {Integer} [fromIndex] - starting index\n     * @return {Integer} - the item's index\n     */\n    getIndex (item, fromIndex) {\n        return this.items.indexOf(item, fromIndex);\n    }\n\n    /**\n     * Checks if item is at front of render order\n     * @method Collection#isAtFront\n     * @param  {Any} item - The item to query\n     * @return {Boolean} - If item is at front\n     */\n    isAtFront (item) {\n        return this.getIndex(item) === this.getCount() - 1;\n    }\n\n    /**\n     * Checks if item is at back of render order\n     * @method Collection#isAtBack\n     * @param  {Any} item - The item to query\n     * @return {Boolean} - If item is at back\n     */\n    isAtBack (item) {\n        return this.getIndex(item) === 0;\n    }\n\n    /**\n     * Moves an item to a new index\n     * @method Collection#move\n     * @param  {Any} movee - the item to move\n     * @param  {Integer} indices - the amount of indices to shift item. Can be positive/negative\n     * @return {Boolean} - Whether the item was successfully moved\n     */\n    move (movee, indices) {\n        const index = this.getIndex(movee);\n\n        if (indices === 0) {\n            return false;\n        }\n\n        // cannot move before begining (don't use isAtBack to save getIndex use)\n        if (index === 0 && indices < 0) {\n            return false;\n        }\n\n        // cannot move past end (don't use isAtFront to save getIndex use)\n        if (index === this.getCount() - 1 && indices > 0) {\n            return false;\n        }\n\n        this.remove(movee);\n        this.addAt(index + indices, movee);\n\n        return true;\n    }\n\n    /**\n     * Moves an item to the front of the render order\n     * @method Collection#moveToFront\n     * @param  {Any} movee - the item to move\n     * @return {Boolean} - Whether item successfully moved\n     */\n    moveToFront (movee) {\n        if (this.isAtFront(movee)) {\n            return false;\n        }\n\n        this.remove(movee);\n        this.addAt(this.getCount(), movee);\n\n        return true;\n    }\n\n    /**\n     * Moves an item to the back of the render order\n     * @method Collection#moveToBack\n     * @param  {Any} movee - the item to move\n     * @return {Boolean} - Whether item successfully moved\n     */\n    moveToBack (movee) {\n        if (this.isAtBack(movee)) {\n            return false;\n        }\n\n        this.remove(movee);\n        this.addAt(0, movee);\n\n        return true;\n    }\n\n    /**\n     * Remove item by name\n     * @method Collection#removeBy\n     * @param {String} removee - The item to remove\n     * @return {Boolean} - Whether item was successfully removed\n     */\n    remove (removee) {\n        let removed = false;\n\n        for (let i = 0, len = this.getCount(); i < len; i++) {\n            let item = this.items[i];\n            if (itemMatch(item, removee)) {\n                this.items.splice(i, 1);\n                removed = true;\n                break;\n            }\n        }\n\n        return removed;\n    }\n\n    /**\n     * Removes all items\n     * @method Collection#removeAll\n     */\n    removeAll () {\n        this.items = [];\n    }\n\n    /**\n     * Remove item at given index\n     * @method Collection#removeAt\n     * @param {Integer} index - The index of the item to remove\n     */\n    removeAt (index) {\n        this.items.splice(index, 1);\n    }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/Pool.js","export const itemMatch = (a, b)=> {\n    return a.uid === b.uid;\n}\n\n// TODO account for camera\nexport const getBoundingBox = (item)=> {\n    let w = item.width * Math.abs(item.scaleX);\n    let h = item.height * Math.abs(item.scaleY);\n    let x1 = item.globalX;\n    let y1 = item.globalY;\n    let x2 = item.scaleX >= 0 ? x1 + w : x1 - w;\n    let y2 = item.scaleY >= 0 ? y1 + h : y1 - h;\n\n    return {\n        minX: x1 <= x2 ? x1 : x2,\n        minY: y1 <= y2 ? y1 : y2,\n        maxX: x1 >= x2 ? x1 : x2,\n        maxY: y1 >= y2 ? y1 : y2\n    };\n}\n\nexport const pointRectCollide = (x, y, rect)=> {\n    let bb = getBoundingBox(rect);\n    return x >= bb.minX && x <= bb.maxX && y >= bb.minY && y <= bb.maxY;\n}\n\nexport const getScaleFactor = (canvas)=> {\n    let factor = 1;\n\n    // check if canvas has been scaled via CSS\n    if (canvas.style.width) {\n        let cssWidth = parseInt(canvas.style.width, 10);\n        factor = canvas.width / cssWidth;\n    }\n\n    return factor;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/util.js","class Xform {\n    constructor () {\n        this.stack = [this.getSet()];\n    }\n\n    translate (x=0, y=0) {\n        let xforms = this.getTransforms();\n\n        xforms.x += x;\n        xforms.y += y;\n    }\n\n    scale (x=1, y=1) {\n        let xforms = this.getTransforms();\n\n        xforms.scaleX *= x;\n        xforms.scaleY *= y;\n    }\n\n    rotate (rad) {\n        let xforms = this.getTransforms();\n\n        xforms.rotation += rad;\n    }\n\n    clone (set) {\n        return {\n            x: set.x,\n            y: set.y,\n            scaleX: set.scaleX,\n            scaleY: set.scaleY,\n            rotation: set.rotation\n        };\n    }\n\n    getSet () {\n        return {\n            x: 0,\n            y: 0,\n            scaleX: 1,\n            scaleY: 1,\n            rotation: 0\n        }\n    }\n\n    getTransforms () {\n        return this.stack[this.stack.length - 1];\n    }\n\n    save () {\n        this.stack.push(\n            this.clone(this.getTransforms())\n        );\n    }\n\n    restore () {\n        this.stack.pop();\n\n        if (!this.stack.length) {\n            this.stack[0] = this.getSet();\n        }\n    }\n}\n\nexport default class Viewport {\n    constructor (options) {\n        this.width = options.width;\n        this.height = options.height;\n        this.canvas = document.querySelector(\"#\" + options.id);\n        this.canvas.width = this.width;\n        this.canvas.height = this.height;\n        this.context = this.canvas.getContext(\"2d\");\n        this.xform = new Xform();\n\n        // save original context operations\n        const original = {\n            translate: this.context.translate,\n            rotate: this.context.rotate,\n            scale: this.context.scale,\n            save: this.context.save,\n            restore: this.context.restore\n        };\n\n        // set new operations that call originals\n        // NOTE setTransform is not currently supported\n        this.context.translate = (x, y)=> {\n            this.xform.translate(x, y);\n            original.translate.call(this.context, x, y);\n            this.context.xform = this.xform.getTransforms();\n        };\n\n        this.context.rotate = (deg)=> {\n            this.xform.rotate(deg);\n            original.rotate.call(this.context, deg);\n            this.context.xform = this.xform.getTransforms();\n        };\n\n        this.context.scale = (x, y)=> {\n            this.xform.scale(x, y);\n            original.scale.call(this.context, x, y);\n            this.context.xform = this.xform.getTransforms();\n        };\n\n        this.context.save = ()=> {\n            this.xform.save();\n            original.save.call(this.context);\n            this.context.xform = this.xform.getTransforms();\n        };\n\n        this.context.restore = ()=> {\n            this.xform.restore();\n            original.restore.call(this.context);\n            this.context.xform = this.xform.getTransforms();\n        };\n    }\n\n    clear (fill) {\n        if (fill) {\n            this.context.fillStyle = fill;\n            this.context.fillRect(0, 0, this.width, this.height);\n        } else {\n            this.context.clearRect(0, 0, this.width, this.height);\n        }\n    }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/Viewport.js","import { itemMatch, getScaleFactor, pointRectCollide } from \"./util\";\n\nclass ClickManager {\n    constructor (start, end) {\n        this.startEvent = start;\n        this.endEvent = end;\n        this.clickee = null;\n    }\n\n    getEvents (event) {\n        let clickEvents = [];\n\n        // emulate events\n        switch (event.type) {\n        case this.startEvent:\n            this.clickee = event.target;\n            break;\n        case this.endEvent:\n            if (this.clickee && itemMatch(this.clickee, event.target)) {\n                let type;\n\n                switch (this.endEvent) {\n                case \"mouseup\":\n                    type = \"click\";\n                    break;\n                case \"touchend\":\n                    type = \"tap\";\n                    break;\n                }\n\n                clickEvents.push(Object.assign({}, event, {\n                    type\n                }));\n            }\n\n            this.clickee = null;\n            break;\n        }\n\n        return clickEvents;\n    }\n}\n\nclass DragManager {\n    constructor (start, move, end) {\n        this.startEvent = start;\n        this.moveEvent = move;\n        this.endEvent = end;\n        this.dragee = null;\n        this.isDragging = false;\n        this.canDrag = false;\n    }\n\n    getEvents (event) {\n        let dragEvents = [];\n\n        // emulate events\n        switch (event.type) {\n        case this.startEvent:\n            this.canDrag = true;\n            this.dragee = event.target;\n            break;\n        case this.moveEvent:\n            if (this.canDrag) {\n                if (!this.isDragging) {\n                    dragEvents.push(Object.assign({}, event, {\n                        type: \"dragstart\",\n                        target: this.dragee\n                    }));\n                }\n\n                dragEvents.push(Object.assign({}, event, {\n                    type: \"drag\",\n                    target: this.dragee\n                }));\n\n                this.isDragging = true;\n            }\n            break;\n        case this.endEvent:\n            if (this.isDragging) {\n                dragEvents.push(Object.assign({}, event, {\n                    type: \"dragend\",\n                    target: this.dragee\n                }));\n\n                this.isDragging = false;\n                this.dragee = null;\n            }\n\n            this.canDrag = false;\n            break;\n        }\n\n        return dragEvents;\n    }\n}\n\nexport default class Input {\n    constructor (canvas, pool, camera, options) {\n        this.canvas = canvas;\n        this.pool = pool;\n        this.camera = camera;\n        this.queuedEvents = [];\n        this.handleEvents = this.handleEvents.bind(this);\n\n        if (options.listenForMouse) {\n            this.canvas.addEventListener(\"mousedown\", this.handleEvents, false);\n            this.canvas.addEventListener(\"mouseup\", this.handleEvents, false);\n            this.canvas.addEventListener(\"mousemove\", this.handleEvents, false);\n            this.canvas.addEventListener(\"wheel\", this.handleEvents, false);\n\n            this.mouseClickManager = new ClickManager(\"mousedown\", \"mouseup\");\n            this.mouseDragManager = new DragManager(\"mousedown\", \"mousemove\", \"mouseup\");\n        }\n\n        if (options.listenForTouch) {\n            this.canvas.addEventListener(\"touchstart\", this.handleEvents, false);\n            this.canvas.addEventListener(\"touchend\", this.handleEvents, false);\n            this.canvas.addEventListener(\"touchmove\", this.handleEvents, false);\n\n            this.touchClickManager = new ClickManager(\"touchstart\", \"touchend\");\n            this.touchDragManager = new DragManager(\"touchstart\", \"touchmove\", \"touchend\");\n        }\n\n        if (options.listenForKeyboard) {\n            this.canvas.addEventListener(\"keydown\", this.handleEvents, false);\n            this.canvas.addEventListener(\"keyup\", this.handleEvents, false);\n        }\n    }\n\n    handleEvents (e) {\n        e.preventDefault();\n        e.stopPropagation();\n\n        let boundingRect = this.canvas.getBoundingClientRect();\n        let scaleFactor = getScaleFactor(this.canvas);\n        let event = {\n            domEvent: e,\n            type: e.type,\n            ctrlKey: e.ctrlKey,\n            shiftKey: e.shiftKey,\n            metaKey: e.metaKey,\n            button: e.button,\n            target: { uid: -1 }\n        };\n\n        if (e.type !== \"keyup\" && e.type !== \"keydown\") {\n            if (e.touches && e.touches.length) {\n                event.x = e.touches[0].pageX;\n                event.y = e.touches[0].pageY;\n            } else if (e.changedTouches && e.changedTouches.length) {\n                event.x = e.changedTouches[0].pageX;\n                event.y = e.changedTouches[0].pageY;\n            } else {\n                event.x = e.pageX;\n                event.y = e.pageY;\n            }\n\n            // coordinate positions relative to canvas scaling\n            event.x = Math.floor((event.x - (boundingRect.left + window.scrollX)) * scaleFactor);\n            event.y = Math.floor((event.y - (boundingRect.top + window.scrollY)) * scaleFactor);\n\n            // TODO is this sustainable as opposed to offsetting items bounding box with camera?\n            event.x += this.camera.x;\n            event.y += this.camera.y;\n\n            // find and set target object\n            this.pool.each((item)=> {\n                if (pointRectCollide(event.x, event.y, item)) {\n                    event.target = item;\n                    // don't break, we want the last-most (highest) item\n                }\n            });\n        }\n\n        if (e.type === \"wheel\") {\n            event.deltaX = e.deltaX;\n            event.deltaY = e.deltaY;\n        }\n\n        this.queuedEvents.push(event);\n\n        this.queuedEvents = this.queuedEvents.concat(\n            this.mouseClickManager ? this.mouseClickManager.getEvents(event) : [],\n            this.touchClickManager ? this.touchClickManager.getEvents(event) : [],\n            this.mouseDragManager ? this.mouseDragManager.getEvents(event) : [],\n            this.touchDragManager ? this.touchDragManager.getEvents(event) : []\n        );\n    }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/Input.js","import { itemMatch } from \"./util\";\n\nexport default class Listeners {\n    constructor (input) {\n        this.input = input;\n        this.dragActionManager = {\n            dragee: null,\n            offset: {\n                x: 0,\n                y: 0\n            },\n\n            handle (event) {\n                switch (event.type) {\n                case \"dragstart\":\n                    if (event.target && event.target.draggable) {\n                        this.dragee = event.target;\n                        this.offset.x = event.x - this.dragee.x;\n                        this.offset.y = event.y - this.dragee.y;\n                    }\n                    break;\n                case \"drag\":\n                    if (this.dragee) {\n                        this.dragee.x = event.x - this.offset.x;\n                        this.dragee.y = event.y - this.offset.y;\n                    }\n                    break;\n                case \"dragend\":\n                    this.dragee = null;\n                    break;\n                }\n            }\n        };\n\n        this.reset();\n    }\n\n    add (type, handler, target) {\n        this.events[type].push({\n            original: handler,\n            handler: handler.bind(this.state),\n            target\n        });\n    }\n\n    remove (type, handler) {\n        for (let i = 0, len = this.events[type].length; i < len; i++) {\n            let event = this.events[type][i];\n\n            if (event.original === handler) {\n                this.events[type].splice(i, 1);\n                break;\n            }\n        }\n    }\n\n    executeHandlers () {\n        for (let event of this.input.queuedEvents) {\n            switch (event.type) {\n            case \"drag\":\n            case \"dragstart\":\n            case \"dragend\":\n                this.dragActionManager.handle(event);\n                break;\n            }\n\n            for (let handlerObj of this.events[event.type]) {\n                // if not drag|dragend event, and target given, and it matches OR no target given\n                // it doesn't apply to drag b/c on fast dragging, the event coordinates will move off the target\n                // it doesn't apply to dragend b/c a dragend can happen on higher (top-most) target\n                if (handlerObj.target ) {\n                    if (event.target && itemMatch(handlerObj.target, event.target)) {\n                        handlerObj.handler(event);\n                    }\n                } else {\n                    handlerObj.handler(event);\n                }\n            }\n        }\n\n        this.input.queuedEvents = [];\n    }\n\n    reset () {\n        // add all - even without listeners - b/c some are implicit eg: drag*\n        this.events = {\n            \"mousedown\": [],\n            \"mouseup\": [],\n            \"mousemove\": [],\n            \"click\": [],\n            \"wheel\": [],\n            \"touchstart\": [],\n            \"touchend\": [],\n            \"touchmove\": [],\n            \"tap\": [],\n            \"drag\": [],\n            \"dragstart\": [],\n            \"dragend\": []\n        }\n    }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/Listeners.js","import Preloader from \"./Preloader\";\n\nexport default class FSM {\n    constructor (game) {\n        this.states = game.states;\n\n        this.game = {\n            reset: game.reset.bind(game),\n            listeners: game.listeners,\n            camera: game.camera,\n            pool: game.pool,\n            width: game.options.width,\n            height: game.options.height\n        };\n    }\n    \n    load (name) {\n        if (this.state && this.state.destroy) {\n            this.state.destroy();\n        }\n\n        this.game.listeners.reset();\n        this.state = this.states[name];\n\n        new Preloader(this.state.preload || [], ()=> {\n            this.state.game = this.game;\n            this.state.game.fsm = this;\n\n            if (this.state.init) {\n                this.state.init();\n            }\n        });\n    }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/FSM.js","export default class Ticker {\n    constructor (callback) {\n        this.callback = callback;\n        this.then = Date.now();\n        this.update = this.update.bind(this);\n        this.cancelled = false\n\n        this.requestId = requestAnimationFrame(this.update);\n    }\n\n    update () {\n        if (this.cancelled) {\n            return;\n        }\n\n        let now = Date.now();\n        // use min to cap delta so things don't go haywire on \"blur\"\n        let delta = Math.min(now - this.then, 32);\n\n        this.callback(delta);\n        this.then = now;    \n\n        this.requestId = requestAnimationFrame(this.update);\n    }\n\n    cancel () {\n        this.cancelled = true;\n        cancelAnimationFrame(this.requestId);\n    }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/Ticker.js","export default class Preloader {\n    constructor (paths, callback) {\n        this.callback = callback;\n        this.loaded = 0;\n        this.count = paths.length;\n\n        if (this.count === 0) {\n            console.warn(\"no assets to load!\");\n            callback();\n            return;\n        }\n\n        for (let path of paths) {\n            let asset;\n\n            switch (this.getType(path)) {\n            case \"audio\":\n                asset = new Audio();\n                break;\n            case \"image\":\n                asset = new Image();\n                break;\n            }\n\n            asset.onload = this.onLoad();\n        }\n    }\n\n    // only works for images and sounds\n    getType (path) {\n        return path.indexOf(\".mp3\") > 0 || path.indexOf(\".wav\") > 0 || path.indexOf(\".ogv\") > 0 ?\n            \"audio\" :\n            \"image\";\n    }\n\n    onLoad () {\n        this.loaded++;\n        console.log(`asset ${this.loaded} of ${this.count} loaded`);\n\n        if (this.loaded === this.count) {\n            console.log(\"all assets loaded!\");\n            this.callback();\n        }\n    }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/Preloader.js","import { getBoundingBox } from \"./util\";\n\nexport const drawGrid = (context, camera, width, height, size=32, color=\"#000\")=> {\n    const widthWithCam = width + camera.x;\n    const heightWithCam = height + camera.y;\n    const halfWidth = widthWithCam / 2;\n    const halfHeight = heightWithCam / 2;\n    const linesX = widthWithCam / size;\n    const linesY = heightWithCam / size;\n    const count = linesX > linesY ? linesX : linesY;\n    let i = -1;\n\n    context.save();\n    context.strokeStyle = color;\n    context.translate(width / 2, height / 2);\n    context.globalAlpha = 0.6;\n    context.lineWidth = 1;\n\n    while (i++ < count) {\n        if (i !== 0) {\n            context.globalAlpha = i % 2 > 0 ? 0.2 : 0.4;\n        }\n\n        context.beginPath();\n        \n        context.moveTo(-halfWidth, -i * size);\n        context.lineTo(widthWithCam, -i * size);\n        context.moveTo(-halfWidth, i * size);\n        context.lineTo(widthWithCam, i * size);\n        \n        context.moveTo(-i * size, -halfHeight);\n        context.lineTo(-i * size, heightWithCam);\n        context.moveTo(i * size, -halfHeight);\n        context.lineTo(i * size, heightWithCam);\n        \n        context.stroke();\n    }\n\n    context.restore();\n}\n\nexport const drawPivot = (context, item, size=16, color=\"#FFF\")=> {\n    const halfSize = size / 2;\n\n    context.save();\n    context.translate(Math.floor(item.x), Math.floor(item.y));\n    context.rotate(item.rotation * Math.PI / 180);\n    context.scale(item.scaleX, item.scaleY);\n\n    context.strokeStyle = color;\n    context.lineWidth = 4;\n    context.globalAlpha = 0.4;\n\n    context.beginPath();\n    context.moveTo(-halfSize, 0);\n    context.lineTo(halfSize, 0);\n    context.moveTo(0, -halfSize);\n    context.lineTo(0, halfSize);\n    context.stroke();\n    context.restore();\n}\n\nexport const drawBoundingBox = (context, item, color=\"#C66\")=> {\n    let bb = getBoundingBox(item);\n\n    context.save();\n    context.fillStyle = color;\n    context.lineWidth = 2;\n    context.globalAlpha = 0.4;\n    context.fillRect(bb.minX, bb.minY, bb.maxX - bb.minX, bb.maxY - bb.minY);\n    context.restore();\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/debug.js","class Sprite {\n    constructor (x=0, y=0) {\n        this.x = x;\n        this.y = y;\n        this.width = 64;\n        this.height = 64;\n        this.alpha = 1;\n        this.rotation = 0;\n        this.scaleX = 1;\n        this.scaleY = 1;\n        this.pivotX = 0;\n        this.pivotY = 0;\n        this.draggable = false;\n        this.visible = true;\n        this.composite = \"source-over\";\n        this.uid = Sprite.uid++;\n    }\n\n    render (context) {\n        if (!this.visible) {\n            return;\n        }\n\n        context.translate(Math.floor(this.x), Math.floor(this.y));\n        context.rotate(this.rotation * Math.PI / 180);\n        context.scale(this.scaleX, this.scaleY);\n        context.translate(Math.floor(-this.pivotX), Math.floor(-this.pivotY));\n\n        context.globalAlpha = this.alpha;\n        context.globalCompositeOperation = this.compositeOperation;\n    }\n\n    get globalX () {\n        return this.x - this.pivotX * this.scaleX;\n    }\n\n    get globalY () {\n        return this.y - this.pivotY * this.scaleY;\n    }\n}\n\nSprite.uid = 0;\n\nexport default Sprite;\n\n\n\n// WEBPACK FOOTER //\n// ./src/Sprite.js","import Sprite from \"../Sprite\";\n\nexport default class Rectangle extends Sprite {\n    constructor (x, y) {\n        super(x, y);\n\n        this.fill = \"#000\";\n        this.stroke = \"\";\n    }\n\n    render (context) {\n        super.render(context);\n\n        context.beginPath();\n        context.rect(0, 0, this.width, this.height);\n\n        if (this.fill) {\n            context.fillStyle = this.fill;\n            context.fill();\n        }\n\n        if (this.stroke) {\n            context.strokeStyle = this.stroke;\n            context.stroke();\n        }\n    }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/shape/Rectangle.js"],"sourceRoot":""}